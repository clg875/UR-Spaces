{% extends 'base.html' %}
    {% block title %}
    <h1>Post</h1>
    {% endblock %}
    
    {% block content %}
    <main>
      <!-- Display Post -->
        <section class="box">
        <div class="forum-item">
            <a href="{{post.User_ID.get_url}}"> {{post.User_ID.User_ID.username}} </a>
            <span> {{post.post_date}} </span>
        </div>
        <div class="forum-item">
          <span> {{post.post_name}} </span>
        </div>
        <div class="forum-item">
          <span> {{post.contents}} </span>
        </div>
        <div class="post-item">
          <input type="button" value="Likes: 10" class="btn1"><i class="fa-regular fa-heart"></i>
          <p> Comments: {{post.num_comments}} </p>

          <!-- Post Buttons available-->
          {%if  post.User_ID.User_ID.username  == request.user.username or moderator is not None%}
          <form action="." method="POST">
            {% csrf_token %}
            <input type="submit" value="Delete Post" class="btn2" name="deletePost_btn" >
          </form>
          {% endif %}

          {%if moderator is None %}
            {%if  post.User_ID.User_ID.username  == request.user.username %}
          <input onclick="reveal()", type="button" value="Edit Post" class="btn2">
            {%else%}
          <input type="button" value="Report User" class="btn2">
            {% endif %}
          {%else %}
          <input type="button" value="Ban User" class="btn2">
          {% endif %}

          <!-- Edit Post -->
          <div id = "reveal" style="display: none">
          <form action="." method="POST">
            {% csrf_token %}
            <section class="box">
            <div class="forum-item">
              <p> Edit Contents: </p>
            </div>
            <div class="forum-item">
              {{form.contents}}
            </div>
            {% if error %}
            <div class="forum-item">
                    <p style="color: red">Content cannot be blank.</p>
            </div>
            {%endif%}
            
            <div class="forum-item">
              <input type="submit" value="Submit" name="editPost_form">
            </div>
          </section>
        </form>
      </div>

      </section>

      <!-- Display Comments -->        
      {% for field in comments %}
        <section class="sub-box">
            <div class="forum-item">
              {%if  field.User_ID.User_ID.username  == request.user.username%}
                <a href="{% url 'profile' %}"> {{field.User_ID.User_ID.username}}  </a>
                {%else%} 
                <a href="{{field.User_ID.get_url}}"> {{field.User_ID.User_ID.username}}  </a>
                {% endif %} 
                <span> {{field.com_date}} </span>
            </div>
            <div class="forum-item">
              <span> {{field.com_contents}} </span>
            </div>
            <div class="post-item">
              <input type="button" value="Likes: 10" class="btn1"><i class="fa-regular fa-heart"></i>
            </div>

            <!-- Comment Buttons available-->
            {%if moderator is  None%}
              {%if  field.User_ID.User_ID.username  == request.user.username%}
            
              <form action="{% url 'comment_update' post.slug  field.id %}" method="POST" id="deleteCommentForm">
              {% csrf_token %}
              <input type="submit" value="Delete Comment" class="btn2" name="deleteComment_btn">
              <input type="button", onclick="revealComment('field{{field.id}}', 'field{{firstCommentId}}')", value="Edit Comment" class="btn2">
              </form>
              {%else%}
                
              <input type="button" value="Report User" class="btn2">
                {% endif %}
                {%else %}
                <input type="button" value="Ban User" class="btn2">
              {% endif %}

              <!-- {%if moderator is  None%}
                {%if  field.User_ID.User_ID.username  == request.user.username%}
                <input type="button", onclick="revealComment('field{{field.id}}')", value="Edit Comment" class="btn2">
                {%else%}
                <input type="button" value="Report User" class="btn2">
                {% endif %}
              {%else %}
              <input type="button" value="Ban User" class="btn2">
              {% endif %} -->

            <!-- Edit Comment -->  
              <form method="POST" action="{% url 'comment_update' post.slug field.pk %}" id="editCommentForm">
                {% csrf_token %}
                <div id = "field{{field.id}}" style="display: none">
                <section class="sub-box">
                <div class="forum-item">
                  <p> Edit Comment: </p>
                </div>
                <div class="forum-item">
                  {{commentform.com_contents}}

                </div>
                {% if error %}
                <div class="forum-item">
                        <p style="color: red">Comment cannot be blank.</p>
                </div>
                {%endif%}
                <div class="forum-item">
                  <input type="submit" value="Submit" name="editComment_form">
                </div>
              </section>
            </div>
            </form>
          
          </section>
          {% endfor %}

          <!-- Add Comment -->
          <form action="." method="POST">
            {% csrf_token %}
            <section class="sub-box">         
            <div class="forum-item">
              <textarea name="newContents"  cols="130" rows="3" placeholder="Input comment here..."></textarea>
            </div>
            <div class="forum-item">
              <input type="submit" value="Submit" name="newComment_form">
            </div>
          </section>
        </form>

    </main>
    {% endblock %}
